<!DOCTYPE html>
<html tabindex="0" data-settings-key="elevation-profile-settings-v1" class="passive-overlay-scrollbars">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval';"/>

        <title>üìä Elevation Profile</title>

        <!-- Core dependencies -->
        <script src="/pages/src/preloads.js"></script>
        <script src="./src/fit.parser.entry.js" onerror="console.error('‚ùå Failed to load FIT parser')"></script>
        
        <!-- Validate FIT parser availability -->
        <script>
            window.addEventListener('DOMContentLoaded', () => {
                if (typeof window.FitParser === 'undefined') {
                    console.error('‚ùå FitParser not loaded! Check file path: ./src/fit.parser.entry.js');
                    alert('ERROR: FIT Parser failed to load. Check console for details.');
                } else {
                    console.log('‚úÖ FitParser loaded successfully');
                }
            });
        </script>

        <!-- Styles -->
        <link id="favicon" rel="shortcut icon" href="/images/favicon.png"/>
        <link rel="stylesheet" href="/pages/css/common.css"/>
        <link rel="stylesheet" href="./css/elevation_profile.css"/>

        <!-- Main application module -->
        <script type="module">
            console.log('üì¶ Initializing Elevation Profile...');
            try {
                const module = await import('./src/elevation_profile.mjs');
                console.log('‚úÖ Module loaded successfully');
                await module.main();
            } catch (error) {
                console.error('‚ùå Failed to load module:', error);
                alert(`ERROR: ${error.message}\n\nCheck console for details.`);
            }
        </script>
    </head>
    
    <body class="transparent-bg">
        <!-- Window titlebar -->
        <div id="titlebar">
            <header>
                <div class="logo"><img src="/pages/images/icon128.png" alt="Logo"/></div>
                <div class="title">üìä Elevation Profile</div>
                <div class="filler"></div>
                <div class="buttons">
                    <a class="button" onClick="window.location.reload()" title="Reload">&#x21bb;</a>
                    <div title="Minimize" class="button minimize electron-only"><ms>minimize</ms></div>
                    <div title="Close this window" class="button close electron-only"><ms>close</ms></div>
                </div>
            </header>
        </div>
        
        <!-- Main content area -->
        <div id="content">
            <!-- Elevation chart container -->
            <div class="elevation-container" role="img" aria-label="Elevation profile chart"></div>
            
            <!-- Control buttons -->
            <div class="controls-overlay" role="toolbar" aria-label="Chart controls">
                <button class="control-btn" id="load-fit-btn" title="Load FIT file" aria-label="Load FIT file">
                    üìÇ
                </button>
                <button class="control-btn" id="processing-options-btn" title="FIT processing options" aria-label="Processing options">
                    ‚öôÔ∏è
                </button>
                <button class="control-btn active" id="toggle-checkpoints-btn" title="Toggle checkpoint visibility" aria-label="Toggle checkpoints">
                    üìç
                </button>
                <button class="control-btn" id="clear-btn" title="Clear all checkpoints" aria-label="Clear checkpoints">
                    üóëÔ∏è
                </button>
            </div>
            
            <!-- Hidden file input -->
            <input type="file" id="fit-file-input" accept=".fit" style="display: none;" aria-hidden="true"/>
        </div>
        
        <!-- Notification toast -->
        <div class="notification" id="notification" role="alert" aria-live="polite" style="display: none;"></div>
    </body>
</html>